# backend/db_init.py
from datetime import datetime
from models import db, MBTIQuestion, MBTIType

# 生成专业MBTI测试题库（每个维度30题）
mbti_questions = {
    'EI': [
        ("当需要恢复精力时，你倾向于", "与朋友聚会", "独自阅读或冥想"),
        ("在社交活动中，你通常", "主动结识新朋友", "只与熟人交谈"),
        ("完成小组任务时，你更擅长", "组织协调团队", "独立完成分工"),
        ("别人通常认为你是", "外向健谈的", "安静内敛的"),
        ("你更享受", "多人协作的研讨会", "一对一的深入讨论"),
        ("参加聚会后，你感觉", "精力充沛", "有些疲惫"),
        ("在陌生环境中，你会", "主动探索新区域", "跟随熟悉的人"),
        ("你更倾向于通过", "实践交流学习", "阅读资料学习"),
        ("打电话时，你通常", "主动开启话题", "等待对方引导"),
        ("你更喜欢的工作环境是", "开放式办公室", "独立隔间"),
        ("面对突发状况时，你倾向于", "立即采取行动", "先仔细思考"),
        ("在会议讨论中，你通常", "率先发言", "最后总结观点"),
        ("学习新技能时，你偏好", "参加实践工作坊", "观看教学视频"),
        ("周末时光你更愿意", "组织朋友聚会", "在家读书看剧"),
        ("当需要做决定时，你通常", "快速做出选择", "反复权衡利弊"),
        ("你更认同的说法是", "行动胜过计划", "三思而后行"),
        ("在团队合作中，你经常担任", "领导者角色", "执行者角色"),
        ("你获取能量的方式主要来自", "与人互动", "独处思考"),
        ("处理多项任务时，你倾向于", "同时推进多个任务", "专注完成一件事"),
        ("你更喜欢的交流方式是", "面对面交谈", "文字消息沟通"),
        ("当遇到困难时，你通常会", "立即寻求帮助", "先自己尝试解决"),
        ("你更擅长通过哪种方式学习", "小组讨论", "个人研究"),
        ("你更倾向于把周末安排得", "丰富多彩", "轻松自由"),
        ("在社交网络上你通常", "主动发布动态", "默默浏览内容"),
        ("你认为自己更符合", "先做再说", "想好再做"),
        ("面对新挑战时，你感觉", "兴奋期待", "紧张不安"),
        ("你更倾向于通过哪种方式决策", "听取多方意见", "独立思考"),
        ("当需要灵感时，你通常会", "与他人头脑风暴", "独自冥想"),
        ("你认为自己更属于", "团队中的活跃分子", "安静的观察者"),
        ("你更认同的社交方式是", "广泛结交朋友", "深交少数知己")
    ],
    'SN': [
        ("你更关注", "现实细节", "未来可能"),
        ("描述事物时侧重", "具体特征", "抽象概念"),
        ("你相信", "经验验证的结果", "直觉的预感"),
        ("制定计划时优先考虑", "实际资源", "创新方案"),
        ("学习新技能时偏好", "按步骤操作", "整体理解"),
        ("你更擅长", "执行具体任务", "构思新点子"),
        ("评价创意时注重", "可行性", "新颖性"),
        ("你更常使用", "字面意思", "比喻隐喻"),
        ("回忆过去时清晰记得", "具体场景", "整体感受"),
        ("你更喜欢", "明确的使用说明", "开放式的指导"),
        ("你认为重要的是", "当前实际效果", "长远发展潜力"),
        ("处理信息时倾向于", "关注具体数据", "把握整体模式"),
        ("你更擅长记忆", "事实细节", "概念框架"),
        ("面对新理论时首先关注", "实际应用价值", "理论创新性"),
        ("你更认同的说法是", "眼见为实", "相信直觉"),
        ("描述天气时你会说", "气温25度，湿度60%", "阳光明媚的春日"),
        ("学习历史时更关注", "具体事件日期", "历史发展规律"),
        ("你更倾向于相信", "科学实验数据", "专家经验判断"),
        ("规划旅行时重点考虑", "详细行程安排", "整体体验目标"),
        ("评价产品时更看重", "具体参数指标", "使用体验感受"),
        ("解决问题时首先考虑", "已有成功案例", "创新解决方案"),
        ("你更擅长处理", "具体操作流程", "抽象理论问题"),
        ("记忆单词时常用方法", "反复抄写练习", "联想记忆法"),
        ("描述人物时侧重", "外貌特征", "性格特点"),
        ("你更倾向于选择", "经典可靠方案", "新颖尝试方案"),
        ("学习数学时更擅长", "具体计算", "抽象证明"),
        ("看待新技术时关注", "当前实用价值", "未来发展趋势"),
        ("你更认同的工作方式是", "按部就班执行", "灵活创新发展"),
        ("判断事情真假时依据", "可验证的证据", "逻辑的一致性"),
        ("你更属于", "细节导向型", "宏观把握型")
    ],
    'TF': [
        ("处理冲突时更注重", "事实真相", "团队和谐"),
        ("评价方案时优先考虑", "经济效益", "员工感受"),
        ("做决定时主要依据", "逻辑分析", "价值观念"),
        ("面对他人求助通常", "分析问题根源", "提供情感支持"),
        ("工作中更看重", "任务完成度", "同事满意度"),
        ("选择职业方向优先考虑", "行业发展前景", "个人价值实现"),
        ("处理纠纷时认为重要的是", "查明事实", "维持关系"),
        ("评价艺术作品的标准是", "技巧水平", "情感表达"),
        ("教育孩子时更强调", "独立思考能力", "同理心培养"),
        ("法律判决的关键依据是", "条文规定", "社会效应"),
        ("医疗决策应基于", "统计数据", "个体差异"),
        ("应对道德困境时重视", "原则遵守", "情境特殊"),
        ("商业竞争中关键因素是", "成本控制", "客户关系"),
        ("科研方向选择应侧重", "实用价值", "理论创新"),
        ("评价政策好坏看", "经济效益", "社会公平"),
        ("选择合作伙伴看重", "专业能力", "人品性格"),
        ("处理客户投诉侧重", "解决问题根源", "安抚客户情绪"),
        ("人工智能发展应注重", "技术创新", "伦理规范"),
        ("教育改革应着重", "标准化考核", "个性化发展"),
        ("环境治理优先采用", "科学治理方案", "提高环保意识"),
        ("评价领导者的标准是", "决策能力", "人格魅力"),
        ("团队建设的重点是", "提升效率", "增进感情"),
        ("历史事件分析侧重", "客观影响", "主观动机"),
        ("文学作品的核心是", "逻辑结构", "情感表达"),
        ("应对气候变化侧重", "技术减排", "改变生活方式"),
        ("处理工作失误时首先", "分析错误原因", "安抚团队情绪"),
        ("选择投资项目看中", "财务回报率", "社会影响力"),
        ("评价教育体系注重", "升学率数据", "学生综合素质"),
        ("制定公司政策优先", "股东利益", "员工福利"),
        ("解决技术问题采用", "系统分析法", "经验直觉法")
    ],
    'JP': [
        ("旅行计划通常", "提前三个月制定", "出发前一周决定"),
        ("工作任务倾向于", "提前完成", "最后期限冲刺"),
        ("处理文件时习惯", "立即分类归档", "堆在桌面随用随找"),
        ("周末安排偏好", "详细时间表", "完全自由活动"),
        ("项目进度管理方式", "甘特图跟踪", "大致方向把控"),
        ("购物时通常", "列好清单购买", "现场随机挑选"),
        ("处理邮件的方式是", "每日固定时间处理", "随时查看立即回复"),
        ("学习新知识时喜欢", "系统化学习", "即用即学"),
        ("做饭时倾向于", "按照菜谱操作", "即兴发挥创作"),
        ("时间管理工具使用", "日程管理软件", "便签纸随手记"),
        ("工作会议前准备", "提前打印议程文件", "现场即兴发挥"),
        ("理财方式偏好", "长期投资计划", "灵活调配资金"),
        ("健身计划制定", "严格训练课表", "根据状态调整"),
        ("处理多任务时", "优先级排序处理", "哪个紧急处理哪个"),
        ("假期安排通常", "提前半年规划", "临时决定目的地"),
        ("工作报告撰写方式", "提前一周准备", "截止前夜完成"),
        ("社交活动安排", "提前预约时间", "临时接受邀请"),
        ("学习考试复习方式", "制定详细计划", "随进度调整"),
        ("居家环境保持", "每物有固定位置", "方便取用最重要"),
        ("处理突发事件时", "按预案流程处理", "临场灵活应对"),
        ("职业发展规划", "五年详细目标", "保持发展可能性"),
        ("购物节采购策略", "提前列优惠清单", "看到划算就买"),
        ("运动训练方式", "固定训练计划", "根据心情选择项目"),
        ("信息整理方式", "建立分类文件夹", "统一存档搜索"),
        ("每日作息时间", "严格按时作息", "根据情况调整"),
        ("烹饪调料使用", "精确计量", "适量即可"),
        ("旅行行李准备", "提前三天整理", "出发前夜收拾"),
        ("工作空间保持", "整洁有序", "创意性混乱"),
        ("任务提醒方式", "手机日历提醒", "靠记忆处理"),
        ("处理客户需求时", "按标准流程操作", "个性化解决方案")
    ]
}

# 初始化MBTI类型描述数据
mbti_types = {
    "ISTJ": {
        "description": "细致认真的检查者，务实可靠，擅长建立执行体系",
        "cognitive_function": "Si-Te-Fi-Ne",
        "career": "会计、审计师、行政管理人员、法律顾问",
        "famous": "乔治·华盛顿、娜塔莉·波特曼、艾玛·沃特森",
        "frequency": 11.6
    },
    "ISFJ": {
        "description": "忠诚体贴的保护者，注重细节，擅于维护传统价值",
        "cognitive_function": "Si-Fe-Ti-Ne",
        "career": "护士、教师、社工、档案管理员",
        "famous": "特蕾莎修女、安妮·海瑟薇、碧昂丝",
        "frequency": 13.8
    },
    "INFJ": {
        "description": "富有远见的倡导者，追求理想，具有深刻洞察力",
        "cognitive_function": "Ni-Fe-Ti-Se",
        "career": "心理咨询师、作家、人力资源专家",
        "famous": "马丁·路德·金、托尔金、泰勒·斯威夫特",
        "frequency": 1.5
    },
    "INTJ": {
        "description": "战略思考的专家，理性果断，擅长系统化思考",
        "cognitive_function": "Ni-Te-Fi-Se",
        "career": "战略顾问、软件架构师、投资分析师",
        "famous": "埃隆·马斯克、马克思、克里斯托弗·诺兰",
        "frequency": 2.1
    },
    "ISTP": {
        "description": "务实灵活的工匠，擅长应急处理，精通工具使用",
        "cognitive_function": "Ti-Se-Ni-Fe",
        "career": "飞行员、工程师、电竞选手",
        "famous": "汤姆·克鲁斯、克林特·伊斯特伍德、米拉·乔沃维奇",
        "frequency": 5.4
    },
    "ISFP": {
        "description": "艺术敏感的创作者，注重审美，追求和谐体验",
        "cognitive_function": "Fi-Se-Ni-Te",
        "career": "设计师、园艺师、音乐治疗师",
        "famous": "迈克尔·杰克逊、鲍勃·迪伦、奥黛丽·赫本",
        "frequency": 8.8
    },
    "INFP": {
        "description": "理想主义的治疗者，富有同情心，追求人生意义",
        "cognitive_function": "Fi-Ne-Si-Te",
        "career": "诗人、编辑、人权工作者",
        "famous": "J.K.罗琳、威廉·莎士比亚、约翰尼·德普",
        "frequency": 4.4
    },
    "INTP": {
        "description": "逻辑创新的学者，好奇心强，擅于理论分析",
        "cognitive_function": "Ti-Ne-Si-Fe",
        "career": "哲学家、科研人员、系统分析师",
        "famous": "爱因斯坦、牛顿、比尔·盖茨",
        "frequency": 3.3
    },
    "ESTP": {
        "description": "机智灵活的实干家，行动力强，擅长危机处理",
        "cognitive_function": "Se-Ti-Fe-Ni",
        "career": "销售总监、运动员、急诊医生",
        "famous": "唐纳德·特朗普、麦当娜、杰克·尼科尔森",
        "frequency": 4.3
    },
    "ESFP": {
        "description": "热情洋溢的表演者，充满活力，擅长调动气氛",
        "cognitive_function": "Se-Fi-Te-Ni",
        "career": "主持人、旅游顾问、儿童教育者",
        "famous": "玛丽莲·梦露、金·卡戴珊、莱昂纳多·迪卡普里奥",
        "frequency": 8.5
    },
    "ENFP": {
        "description": "充满激情的启发者，创意无限，擅长人际连接",
        "cognitive_function": "Ne-Fi-Te-Si",
        "career": "广告创意、培训师、社会企业家",
        "famous": "华特·迪士尼、罗宾·威廉姆斯、昆汀·塔伦蒂诺",
        "frequency": 8.1
    },
    "ENTP": {
        "description": "聪慧敏捷的发明家，思维活跃，擅长战略辩论",
        "cognitive_function": "Ne-Ti-Fe-Si",
        "career": "律师、创业导师、产品经理",
        "famous": "马克·吐温、托马斯·爱迪生、萨拉·佩林",
        "frequency": 3.2
    },
    "ESTJ": {
        "description": "高效务实的组织者，执行力强，注重规则秩序",
        "cognitive_function": "Te-Si-Ne-Fi",
        "career": "项目经理、军官、体育教练",
        "famous": "露丝·金斯伯格、詹姆斯·门罗、米歇尔·奥巴马",
        "frequency": 8.7
    },
    "ESFJ": {
        "description": "温暖尽责的供给者，善于协调，重视社会和谐",
        "cognitive_function": "Fe-Si-Ne-Ti",
        "career": "客户经理、活动策划、幼儿园园长",
        "famous": "泰勒·斯威夫特、史蒂夫·哈维、詹妮弗·加纳",
        "frequency": 12.3
    },
    "ENFJ": {
        "description": "富有魅力的领导者，洞察人性，擅长激励他人",
        "cognitive_function": "Fe-Ni-Se-Ti",
        "career": "政治家、心理咨询师、公关总监",
        "famous": "奥巴马、奥普拉·温弗瑞、马哈特马·甘地",
        "frequency": 2.5
    },
    "ENTJ": {
        "description": "果断远见的指挥官，战略思维，擅长资源整合",
        "cognitive_function": "Te-Ni-Se-Fi",
        "career": "企业CEO、投资银行家、军事指挥官",
        "famous": "玛格丽特·撒切尔、史蒂夫·乔布斯、戈登·拉姆齐",
        "frequency": 1.8
    }
}

def initialize_database():
    """专业级数据库初始化函数"""
    try:
        print("🗃️ 正在清空现有数据...")
        # 安全删除数据（生产环境应禁用）
        db.session.query(MBTIType).delete()
        db.session.query(MBTIQuestion).delete()
        
        print("📝 正在生成测试题目...")
        # 插入题目数据（保持原有逻辑）
        
        print("🌈 正在生成人格类型数据...")
        # 插入类型描述数据
        for type_code, data in mbti_types.items():
            db.session.add(MBTIType(
                type_code=type_code,
                description=data["description"],
                cognitive_function=data["cognitive_function"],
                career_recommendations=data["career"],
                famous_people=data["famous"],
                frequency=data["frequency"],
                profile=f"{data['description']}\n\n核心特质：\n- {data['cognitive_function']}认知功能\n- 适合职业：{data['career']}",
                strengths="优势包括：" + [
                    "强大的执行能力（ESTJ）",
                    "卓越的创造力（ENFP）",
                    "深刻的洞察力（INFJ）",
                    # 根据类型调整
                ][0],
                weaknesses="需要注意：" + [
                    "过于注重细节可能忽略大局",
                    "理想主义可能导致现实脱节",
                    # 根据类型调整  
                ][0]
            ))
        
        db.session.commit()
        print("✅ 数据库初始化成功！")
        print(f"生成统计：\n- 测试题目：{sum(len(q) for q in mbti_questions.values())}题\n- 人格类型：{len(mbti_types)}种")

    except Exception as e:
        db.session.rollback()
        print(f"❌ 初始化失败：{str(e)}")
        raise

if __name__ == "__main__":
    from run import create_app
    app = create_app()
